# SSH终端功能使用指南

## 功能概述

SSH终端功能允许用户通过Web界面直接SSH连接到Kubernetes节点，提供类似于本地终端的体验。

## 功能特性

### 前端特性
- 基于xterm.js的现代终端界面
- 支持颜色显示和光标闪烁
- 自动适应窗口大小
- 支持密码和私钥两种认证方式
- 连接状态实时显示
- 可配置的连接参数

### 后端特性
- WebSocket实时通信
- SSH协议支持
- 多种认证方式（密码/私钥）
- 安全的连接管理
- 错误处理和日志记录

## 使用方法

### 1. 访问SSH终端

1. 进入节点详情页面
2. 点击"SSH终端"标签页
3. 点击"连接"按钮

### 2. 配置SSH连接

在连接配置对话框中填写以下信息：

- **主机地址**: 节点的IP地址（自动填充节点内部IP）
- **端口**: SSH服务端口（默认22）
- **用户名**: SSH登录用户名（默认root）
- **认证方式**: 选择密码认证或私钥认证

#### 密码认证
- 选择"密码认证"
- 输入SSH密码

#### 私钥认证
- 选择"私钥认证"
- 粘贴私钥内容（PEM格式）

### 3. 建立连接

1. 填写完配置信息后点击"连接"
2. 系统会显示连接状态
3. 连接成功后即可使用终端

### 4. 使用终端

- 支持所有标准的Linux命令
- 支持颜色输出
- 支持Tab补全（取决于远程系统配置）
- 支持历史命令（上下箭头键）

### 5. 断开连接

- 点击"断开连接"按钮
- 或直接关闭浏览器标签页

## 技术架构

### 前端组件
- `SSHTerminal.tsx`: 主要的SSH终端组件
- 使用xterm.js作为终端模拟器
- WebSocket客户端处理实时通信

### 后端处理
- `ssh_terminal.go`: SSH终端处理器
- WebSocket服务器处理连接升级
- SSH客户端管理远程连接

### 通信协议

WebSocket消息格式：
```json
{
  "type": "connect|input|resize|data|error|connected|disconnected",
  "data": "消息内容",
  "config": {
    "host": "主机地址",
    "port": 22,
    "username": "用户名",
    "authType": "password|key",
    "password": "密码",
    "privateKey": "私钥内容"
  },
  "cols": 80,
  "rows": 24,
  "error": "错误信息"
}
```

## 安全注意事项

1. **主机密钥验证**: 当前版本跳过了SSH主机密钥验证，生产环境应该启用
2. **认证信息**: 密码和私钥通过WebSocket传输，建议使用HTTPS
3. **访问控制**: 建议配置适当的用户权限和网络访问控制
4. **审计日志**: 建议记录SSH连接和操作日志

## 故障排除

### 常见问题

1. **连接超时**
   - 检查节点IP地址是否正确
   - 确认SSH服务是否运行（端口22）
   - 检查网络连通性

2. **认证失败**
   - 验证用户名和密码是否正确
   - 检查私钥格式是否正确（PEM格式）
   - 确认用户是否有SSH登录权限

3. **WebSocket连接失败**
   - 检查后端服务是否运行
   - 确认防火墙设置
   - 检查浏览器WebSocket支持

### 调试方法

1. 查看浏览器开发者工具的网络和控制台标签
2. 检查后端日志输出
3. 验证SSH服务配置

## 依赖项

### 前端依赖
- xterm: ^5.3.0
- xterm-addon-fit: ^0.8.0
- xterm-addon-web-links: ^0.9.0

### 后端依赖
- golang.org/x/crypto/ssh
- github.com/gorilla/websocket

## 未来改进

1. 支持SSH密钥管理
2. 添加会话录制功能
3. 支持多标签页终端
4. 增强安全性（主机密钥验证）
5. 添加文件传输功能
6. 支持SSH隧道